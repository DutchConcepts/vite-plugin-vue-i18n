{"version":3,"file":"index.cjs","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import pc from 'picocolors';\n\nexport function logWarning(...args: unknown[]) {\n  console.warn(pc.yellow(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function logSuccess(...args: unknown[]) {\n  console.log(pc.green(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function logError(...args: unknown[]) {\n  console.error(pc.red(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function error(message: string) {\n  throw new Error(`[vite-plugin-vue-i18n] ${message}`);\n}\n","import { type HmrContext, type Plugin } from 'vite';\nimport { readFileSync, writeFileSync } from 'fs';\nimport { promise as glob } from 'glob-promise';\nimport { cwd } from 'process';\nimport minimatch from 'minimatch';\nimport path from 'path';\nimport pc from 'picocolors';\n\nimport { logError, logSuccess } from '@/utils';\n\n/**\n * The options object of the plugin.\n * * `ResourcesPattern` should be an {@link https://github.com/isaacs/minimatch minimatch} pattern.\n * * `output` should be a path ending with a filename starting from the `src` folder of your project. The path of the example below would be `./src/i18n/locales/index.ts`. The generated file will always be an TypeScript file and thus ending with the `.ts` extension.\n * @example\n * {\n *  resourcesPattern: 'i18n/locales/**\\/**.json',\n *  output: 'i18n/locales/index'\n * }\n */\ninterface IOptions {\n  resourcesPattern: string;\n  output: string;\n}\n\n/**\n * @param options\n * @returns Plugin\n */\nfunction vueI18n({ resourcesPattern, output }: IOptions): Plugin {\n  return {\n    name: 'vite-plugin-vue-i18n',\n\n    buildStart: async () => {\n      try {\n        await compileLocaleFile({ resourcesPattern, output });\n      } catch (e) {\n        logError('Building resources on start went wrong...', e);\n      }\n    },\n\n    handleHotUpdate: async (ctx: HmrContext) => {\n      const localesPattern = path.resolve(cwd(), resourcesPattern);\n      const isMatch = minimatch(ctx.file, localesPattern);\n\n      if (isMatch) {\n        try {\n          await compileLocaleFile({ resourcesPattern, output });\n        } catch (e) {\n          logError('Building resources on hot reload went wrong...', e);\n        }\n      }\n    },\n  };\n}\n\nasync function compileLocaleFile({ resourcesPattern, output }: IOptions) {\n  const files = await glob(`./src/${resourcesPattern}`);\n\n  const messages: Record<'nl-NL' | 'en-GB', { [k: string]: unknown }> = {\n    'nl-NL': {},\n    'en-GB': {},\n  };\n\n  for (const path of files) {\n    const buffer = readFileSync(path, { encoding: 'utf-8' });\n    const json = JSON.parse(buffer);\n\n    const parts = path.split('/');\n    const lang = parts[4];\n    const fileName = parts[parts.length - 1];\n    const componentName = fileName.split('.')[0];\n\n    if (lang === 'nl-NL' || lang === 'en-GB') {\n      messages[lang][componentName] = json;\n    }\n  }\n\n  const jsonData = JSON.stringify(messages);\n  const codeStr = `// THIS FILE IS GENERATED, DO NOT EDIT!\\nconst messages = ${jsonData};\\ntype Messages = typeof messages;\\n export { messages, type Messages };`;\n\n  writeFileSync(`./src/${output}.ts`, codeStr);\n\n  logSuccess('Generated vue-i18n locales!', pc.green('âœ”'));\n}\n\nexport { vueI18n };\n"],"names":["logSuccess","args","console","log","pc","green","bold","logError","error","red","vueI18n","resourcesPattern","output","name","buildStart","compileLocaleFile","e","handleHotUpdate","ctx","localesPattern","path","resolve","cwd","isMatch","minimatch","file","files","glob","messages","buffer","readFileSync","encoding","json","JSON","parse","parts","split","lang","fileName","length","componentName","jsonData","stringify","codeStr","writeFileSync"],"mappings":"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"}