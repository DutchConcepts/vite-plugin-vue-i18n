{"version":3,"file":"index.umd.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import pc from 'picocolors';\n\nexport function logWarning(...args: unknown[]) {\n  console.warn(pc.yellow(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function logSuccess(...args: unknown[]) {\n  console.log(pc.green(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function logError(...args: unknown[]) {\n  console.error(pc.red(pc.bold(`[vite-plugin-vue-i18n] `)), ...args);\n}\n\nexport function error(message: string) {\n  throw new Error(`[vite-plugin-vue-i18n] ${message}`);\n}\n","import { type HmrContext, type Plugin } from 'vite';\nimport { readFileSync, writeFileSync } from 'fs';\nimport { promise as glob } from 'glob-promise';\nimport { cwd } from 'process';\nimport minimatch from 'minimatch';\nimport path from 'path';\nimport pc from 'picocolors';\n\nimport { logError, logSuccess } from '@/utils';\n\ninterface IOptions {\n  // @example 'i18n/locales/**/*.json'\n  resourcesPattern: string;\n  // @example 'i18n/locales/index.ts'\n  outputPath: string;\n}\n\n/**\n * @param options\n * @returns Plugin\n */\nfunction vueI18n({ resourcesPattern, outputPath }: IOptions): Plugin {\n  return {\n    name: 'vite-plugin-vue-i18n',\n\n    buildStart: async () => {\n      try {\n        await compileLocaleFile({ resourcesPattern, outputPath });\n      } catch (e) {\n        logError('Building resources on start went wrong...', e);\n      }\n    },\n\n    handleHotUpdate: async (ctx: HmrContext) => {\n      const localesPattern = path.resolve(cwd(), resourcesPattern);\n      const isMatch = minimatch(ctx.file, localesPattern);\n\n      if (isMatch) {\n        try {\n          await compileLocaleFile({ resourcesPattern, outputPath });\n        } catch (e) {\n          logError('Building resources on hot reload went wrong...', e);\n        }\n      }\n    },\n  };\n}\n\nasync function compileLocaleFile({ resourcesPattern, outputPath }: IOptions) {\n  const files = await glob(`./src/${resourcesPattern}`);\n\n  const messages: Record<'nl-NL' | 'en-GB', { [k: string]: unknown }> = {\n    'nl-NL': {},\n    'en-GB': {},\n  };\n\n  for (const path of files) {\n    const buffer = readFileSync(path, { encoding: 'utf-8' });\n    const json = JSON.parse(buffer);\n\n    const parts = path.split('/');\n    const lang = parts[4];\n    const fileName = parts[parts.length - 1];\n    const componentName = fileName.split('.')[0];\n\n    if (lang === 'nl-NL' || lang === 'en-GB') {\n      messages[lang][componentName] = json;\n    }\n  }\n\n  const jsonData = JSON.stringify(messages);\n  const codeStr = `// THIS FILE IS GENERATED, DO NOT EDIT!\\nconst messages = ${jsonData};\\ntype Messages = typeof messages;\\n export { messages, type Messages };`;\n\n  writeFileSync(`./src/${outputPath}.ts`, codeStr);\n\n  logSuccess('Generated vue-i18n locales!', pc.green('âœ”'));\n}\n\nexport { vueI18n };\n"],"names":["logSuccess","args","console","log","pc","green","bold","logError","error","red","vueI18n","resourcesPattern","outputPath","name","buildStart","compileLocaleFile","e","handleHotUpdate","ctx","localesPattern","path","resolve","cwd","isMatch","minimatch","file","files","glob","messages","buffer","readFileSync","encoding","json","JSON","parse","parts","split","lang","fileName","length","componentName","jsonData","stringify","codeStr","writeFileSync"],"mappings":"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"}